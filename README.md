Надо вынести логику админа и пользователя, а то уже ничего не понятно в файле.